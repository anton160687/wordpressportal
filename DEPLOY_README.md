# Инструкция по автоматическому деплою

## Доступные скрипты

### 1. `deploy.ps1` - Полный автоматический деплой
Выполняет все шаги автоматически: коммит, push, обновление на сервере.

**Использование:**
```powershell
.\deploy.ps1 "Описание изменений" "bethday"
```

**Параметры:**
- Первый параметр - комментарий к коммиту (по умолчанию: "Auto deploy")
- Второй параметр - ветка (по умолчанию: "bethday")

**Что делает:**
1. Проверяет наличие изменений
2. Добавляет все файлы в git
3. Создает коммит
4. Переключается на нужную ветку
5. Отправляет изменения в GitHub
6. Подключается к серверу и обновляет код
7. Устанавливает права доступа
8. Очищает кеш WordPress

### 2. `deploy-simple.ps1` - Упрощенный деплой
Только локальные git операции (коммит и push). Обновление на сервере нужно делать вручную.

**Использование:**
```powershell
.\deploy-simple.ps1 "Описание изменений" "bethday"
```

### 3. `deploy.bat` - Обертка для Windows
Удобный запуск из командной строки Windows.

**Использование:**
```cmd
deploy.bat "Описание изменений" "bethday"
```

### 4. `server-update.sh` - Скрипт для сервера
Скрипт для выполнения на сервере (можно вызвать через SSH).

**Использование на сервере:**
```bash
cd /var/www/wordpress
./server-update.sh bethday
```

**Или через SSH с локальной машины:**
```bash
ssh root@217.26.24.243 'cd /var/www/wordpress && bash server-update.sh bethday'
```

## Быстрый старт

### Вариант 1: Полный автоматический деплой
```powershell
.\deploy.ps1 "Добавлен новый функционал"
```

### Вариант 2: Только отправка в GitHub
```powershell
.\deploy-simple.ps1 "Исправлена ошибка"
```

Затем на сервере:
```bash
ssh root@217.26.24.243
cd /var/www/wordpress
git pull origin bethday
```

### Вариант 3: Через batch файл
```cmd
deploy.bat "Обновление плагина"
```

## Настройка SSH

Для автоматического деплоя на сервер нужно настроить SSH без пароля:

1. **Генерация SSH ключа (если еще нет):**
```powershell
ssh-keygen -t rsa -b 4096
```

2. **Копирование ключа на сервер:**
```powershell
type $env:USERPROFILE\.ssh\id_rsa.pub | ssh root@217.26.24.243 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

3. **Проверка подключения:**
```powershell
ssh root@217.26.24.243 "echo 'SSH работает!'"
```

Если SSH не настроен, используйте `deploy-simple.ps1` и обновляйте сервер вручную.

## Параметры сервера

По умолчанию используются:
- IP: `217.26.24.243`
- Пользователь: `root`
- Путь: `/var/www/wordpress`

Для изменения отредактируйте переменные в начале `deploy.ps1`.

## Примеры использования

```powershell
# Простой деплой с автоматическим сообщением
.\deploy.ps1

# Деплой с описанием
.\deploy.ps1 "Исправлена ошибка в header.php"

# Деплой в другую ветку
.\deploy.ps1 "Новая функция" "main"

# Только отправка в GitHub
.\deploy-simple.ps1 "Обновление стилей"
```

## Устранение проблем

### Ошибка "Permission denied" при SSH
Настройте SSH ключи (см. раздел "Настройка SSH")

### Ошибка при push
Убедитесь, что у вас есть права на запись в репозиторий GitHub

### Ошибка на сервере
Проверьте права доступа к директории `/var/www/wordpress`

### Скрипт не запускается
В PowerShell выполните:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

