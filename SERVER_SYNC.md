# Синхронизация сервера после мерджа ветки

## Ситуация
- Ветка `addnews` была смерджена в `main` (или другую ветку) на GitHub
- На сервере много локальных изменений, которые не в git
- Нужно обновить сервер, получив изменения из репозитория

## Последовательность действий на сервере

### Вариант 1: Сохранить локальные изменения (если они нужны)

```bash
# 1. Перейти в директорию проекта
cd /var/www/wordpress

# 2. Проверить статус
git status

# 3. Сохранить локальные изменения в stash (временное хранилище)
git stash save "Локальные изменения перед обновлением"

# 4. Переключиться на main ветку
git checkout main

# 5. Получить последние изменения
git fetch origin

# 6. Обновить локальную ветку main
git pull origin main

# 7. Если нужно восстановить локальные изменения:
git stash pop
```

### Вариант 2: Отменить локальные изменения (если они не нужны)

```bash
# 1. Перейти в директорию проекта
cd /var/www/wordpress

# 2. Проверить статус
git status

# 3. Отменить все локальные изменения
git reset --hard HEAD

# 4. Очистить неотслеживаемые файлы (ОСТОРОЖНО! Удалит файлы не в git)
git clean -fd

# 5. Переключиться на main ветку
git checkout main

# 6. Получить последние изменения
git fetch origin

# 7. Обновить локальную ветку main
git pull origin main
```

### Вариант 3: Создать коммит из локальных изменений (если они важны)

```bash
# 1. Перейти в директорию проекта
cd /var/www/wordpress

# 2. Проверить статус
git status

# 3. Добавить все изменения
git add -A

# 4. Создать коммит
git commit -m "Локальные изменения на сервере"

# 5. Переключиться на main ветку
git checkout main

# 6. Получить последние изменения
git fetch origin

# 7. Обновить локальную ветку main
git pull origin main

# 8. Если нужно, смерджить локальные изменения:
git merge addnews  # или другую ветку с локальными изменениями
```

## Рекомендуемый подход

### Шаг 1: Проверка текущего состояния

```bash
cd /var/www/wordpress
git status
git branch
```

### Шаг 2: Сохранение локальных изменений (на всякий случай)

```bash
# Создать резервную копию
cp -r /var/www/wordpress /var/www/wordpress_backup_$(date +%Y%m%d_%H%M%S)

# Или сохранить в stash
git stash save "Локальные изменения перед обновлением $(date +%Y%m%d_%H%M%S)"
```

### Шаг 3: Обновление из репозитория

```bash
# Переключиться на main
git checkout main

# Получить все изменения
git fetch origin

# Обновить main
git pull origin main
```

### Шаг 4: Проверка

```bash
# Проверить статус
git status

# Проверить последние коммиты
git log --oneline -10

# Проверить, что файлы обновились
ls -la wp-content/plugins/segezha-user-sync/
```

## Если возникли конфликты

```bash
# Посмотреть конфликты
git status

# Разрешить конфликты вручную в файлах
# Затем:
git add <файлы_с_разрешенными_конфликтами>
git commit -m "Разрешение конфликтов после мерджа"
```

## Откат изменений (если что-то пошло не так)

```bash
# Восстановить из stash
git stash list
git stash pop stash@{0}

# Или восстановить из резервной копии
# (если создавали копию)
```

